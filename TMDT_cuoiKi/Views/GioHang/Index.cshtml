@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model IEnumerable<TMDT_cuoiKi.Data.ChiTietGioHang>
<link rel="stylesheet" href="~/css/style_homepage.css" />
<link rel="stylesheet" href="~/style-phong/Style-gioHang.css" />

<div class="container">
    <!-- Progress Indicator -->
    <div class="progress-indicator">
        <div class="progress-step active">
            <div class="step-icon">
                <i>🛒</i>
            </div>
            <div class="step-label">Giỏ hàng</div>
        </div>
        <div class="progress-step">
            <div class="step-icon">
                <i>📋</i>
            </div>
            <div class="step-label">Kiểm tra</div>
        </div>
        <div class="progress-step">
            <div class="step-icon">
                <i>✓</i>
            </div>
            <div class="step-label">Thanh toán</div>
        </div>
    </div>

    <!-- Checkout Content -->
    <div class="checkout-container">
        <!-- Cart Items -->
        <div class="order-details">
            <div class="cart-items">
                @foreach (var item in Model)
                {
                    var product = item.IdsanPhamNavigation;
                    var firstImage = "." + (product.HinhAnhSanPhams.FirstOrDefault()?.HinhAnh ?? "placeholder.jpg");
                    if (product != null)
                    {
                        <div class="cart-item">
                            <img src="@firstImage" alt="@product.TenSanPham" class="cart-item-image">
                            <div class="cart-item-details">
                                <div class="cart-item-title">@product.TenSanPham</div>
                                <div class="cart-item-meta">
                                    <i>📦</i> Miễn phí vận chuyển
                                </div>
                                <div class="cart-item-meta">
                                    <i>✓</i> Đảm bảo chất lượng
                                </div>
                                <div>
                                    <span class="cart-item-price-original text-muted text-decoration-line-through">
                                        @String.Format("{0:N0}đ", product.GiaBan * item.SoLuongDat * 3 / 2)
                                    </span>
                                    <span class="cart-item-price-current text-danger fw-bold">0đ</span>
                                </div>
                            </div>
                            <div class="cart-item-actions">
                                <div class="quantity-control">
                                    <button class="quantity-btn minus">-</button>
                                    <input type="text" class="quantity-input" value="@item.SoLuongDat" readonly>
                                    <button class="quantity-btn plus">+</button>
                                </div>
                                <button class="remove-item">🗑️</button>
                            </div>
                            <input type="hidden" class="unit-price" value="@product.GiaBan" />
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <h3 class="summary-title">Chi tiết thanh toán</h3>

            <div class="summary-row">
                <span>Tạm tính</span>
                <span id="subtotal" class="text-danger fw-bold">0đ</span>
            </div>

            <div class="summary-row">
                <span>Số lượng mặt hàng</span>
                <span id="item-count">0</span>
            </div>

            <div class="summary-row">
                <span>Phí vận chuyển</span>
                <span>0đ</span>
            </div>

            <div class="summary-row total">
                <span>Tổng cộng</span>
                <span id="total" class="text-danger fw-bold">0đ</span>
            </div>

            <button class="checkout-btn">Tiến hành thanh toán</button>
        </div>
        <!-- Related Products -->

    </div>
</div>
<div class="container">
    <div class="related-products">
        <h3 class="section-title">Khách hàng cũng quan tâm</h3>
        <div class="products-grid">
            @foreach (var item in Model)
            {
                var product = item.IdsanPhamNavigation;
                if (product != null)
                {
                    <div class="product-card">
                        <img src="@product.IdsanPham" alt="@product.TenSanPham" class="product-image">
                        <div class="product-info">
                            <div class="product-title">@product.TenSanPham</div>
                            <div class="product-price">@String.Format("{0:N0}đ", product.GiaBan)</div>
                            <div class="product-rating">
                                <div class="stars">⭐ @product.SoLuongTon</div>
                            </div>
                            <div class="product-actions">
                                <button class="add-to-cart">
                                    <i>🛒</i> Thêm vào giỏ
                                </button>
                                <button class="wishlist-btn">❤️</button>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
<script>
    function updateCartSummary() {
        let total = 0;
        let count = 0;

        document.querySelectorAll('.cart-item').forEach(item => {
            const qty = parseInt(item.querySelector('.quantity-input').value);
            const unitPrice = parseInt(item.querySelector('.unit-price').value);
            total += qty * unitPrice;
            count++;
        });

        document.getElementById('subtotal').textContent = total.toLocaleString('vi-VN') + 'đ';
        document.getElementById('total').textContent = total.toLocaleString('vi-VN') + 'đ';
        document.getElementById('item-count').textContent = count;
    }

    document.querySelectorAll('.cart-item').forEach(item => {
        const minusBtn = item.querySelector('.minus');
        const plusBtn = item.querySelector('.plus');
        const quantityInput = item.querySelector('.quantity-input');
        const priceDisplay = item.querySelector('.cart-item-price-current');
        const originalDisplay = item.querySelector('.cart-item-price-original');
        const unitPrice = parseInt(item.querySelector('.unit-price').value);

        function updatePrices() {
            const qty = parseInt(quantityInput.value);
            const currentTotal = unitPrice * qty;
            const originalTotal = Math.floor(currentTotal * 1.5);
            priceDisplay.textContent = currentTotal.toLocaleString('vi-VN') + 'đ';
            originalDisplay.textContent = originalTotal.toLocaleString('vi-VN') + 'đ';
            updateCartSummary();
        }

        minusBtn.addEventListener('click', () => {
            let qty = parseInt(quantityInput.value);
            if (qty > 1) {
                qty -= 1;
                quantityInput.value = qty;
                updatePrices();
            }
        });

        plusBtn.addEventListener('click', () => {
            let qty = parseInt(quantityInput.value);
            qty += 1;
            quantityInput.value = qty;
            updatePrices();
        });

        updatePrices();
    });

    updateCartSummary();
</script>


